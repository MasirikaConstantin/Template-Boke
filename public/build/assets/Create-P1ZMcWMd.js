import{c as We,u as Xe,r as ye,j as s,H as Ye,L as He}from"./app-5Dbz7raP.js";import{B as K}from"./createLucideIcon-BbQnreOs.js";import{I as Ze}from"./input-n7OeVstE.js";import{L as be}from"./label-n2viQgWs.js";import{S as Ve,a as $e,b as Ue,d as ge,c as ze}from"./select-DSj7oFl5.js";import{C as es,a as ss,d as ts,b as as,c as ls}from"./card-M1rE4DpJ.js";import{A as Me,a as Te}from"./alert-Dr0NOMKL.js";import{f as Ee,a as Le,P as rs,b as ns,C as is,c as cs}from"./popover-D0YhiJMK.js";import{T as os,a as ke,b as Be,c as ms}from"./tabs-C0r5JT4A.js";import{D as ds}from"./DashboardLayout-ByUj4ROS.js";import{P as fs}from"./PageHeader-C2_xgV5F.js";import{C as Re}from"./circle-alert-CoLmvAti.js";import{C as us}from"./calculator-DxdJ3Qaz.js";import{A as xs}from"./arrow-left-FA-xRmb0.js";import{C as hs}from"./users-DC4hzx-j.js";import{C as ps}from"./calendar-ByLnJ856.js";import{D as js}from"./file-text-CCJGyrxq.js";import{P as vs}from"./percent-BpsNZdmA.js";/* empty css            */import"./index-BlzE7Lae.js";import"./index-B-6lPV8j.js";import"./check-CkeGpNl8.js";import"./user-C_rpr3N_.js";import"./house-Dl9tCatm.js";function Gs(J){const e=We.c(132),{professeurs:m,today:f}=J;let O;e[0]!==f?(O={professeur_id:"",montant:"",date_avance:f,statut:"demandee"},e[0]=f,e[1]=O):O=e[1];const{data:a,setData:i,post:Se,processing:Ie,errors:r}=Xe(O);let Q;e[2]!==f?(Q=new Date(f),e[2]=f,e[3]=Q):Q=e[3];const[c,qe]=ye.useState(Q),[o,Ge]=ye.useState(null),[l,Je]=ye.useState(0);let W,X;e[4]!==a.professeur_id||e[5]!==m?(W=()=>{if(!a.professeur_id)return;const t=m.find(Qe=>Qe.id.toString()===a.professeur_id);Ge(t||null);const n=t?.salaires;if(!n)return;const Oe=n.type_salaire==="mensuel"?Number(n.salaire_fixe??0):Number(n.taux_horaire??0)*35*4.33;Je(Oe*.5)},X=[a.professeur_id,m],e[4]=a.professeur_id,e[5]=m,e[6]=W,e[7]=X):(W=e[6],X=e[7]),ye.useEffect(W,X);let Y;e[8]!==Se?(Y=t=>{t.preventDefault(),Se("/avance-salaires")},e[8]=Se,e[9]=Y):Y=e[9];const Ce=Y;let Z;e[10]!==i?(Z=t=>{t&&(qe(t),i("date_avance",Ee(t,"yyyy-MM-dd")))},e[10]=i,e[11]=Z):Z=e[11];const De=Z;let ee;e[12]!==i?(ee=t=>{const n=parseFloat(t.replace(/[^0-9.]/g,""))||0;i("montant",n.toFixed(2))},e[12]=i,e[13]=ee):ee=e[13];const we=ee;let se;e[14]!==l||e[15]!==i?(se=t=>{if(l>0){const n=l*t/100;i("montant",n.toFixed(2))}},e[14]=l,e[15]=i,e[16]=se):se=e[16];const Fe=se,d=Ns;console.log(m,l);let te;e[17]===Symbol.for("react.memo_cache_sentinel")?(te=s.jsx(Ye,{title:"Demander une avance sur salaire"}),e[17]=te):te=e[17];let ae;e[18]===Symbol.for("react.memo_cache_sentinel")?(ae=[{label:"Dashboard",href:"/dashboard"},{label:"Finances",href:"#"},{label:"Avances",href:"/avance-salaires"},{label:"Demander",href:"/avance-salaires/create"}],e[18]=ae):ae=e[18];let le;e[19]===Symbol.for("react.memo_cache_sentinel")?(le=s.jsx(fs,{title:"Demander une avance",breadcrumb:ae,actions:s.jsx(He,{href:"/avance-salaires",children:s.jsxs(K,{variant:"outline",children:[s.jsx(xs,{className:"h-4 w-4 mr-2"}),"Retour"]})})}),e[19]=le):le=e[19];let re;e[20]===Symbol.for("react.memo_cache_sentinel")?(re=s.jsxs(es,{children:[s.jsxs(ss,{className:"flex items-center gap-2",children:[s.jsx(hs,{className:"h-5 w-5"}),"Nouvelle demande d'avance"]}),s.jsx(ts,{children:"Remplissez les informations pour demander une avance sur salaire"})]}),e[20]=re):re=e[20];let u;e[21]!==r.date_avance||e[22]!==r.montant||e[23]!==r.professeur_id?(u=(r.professeur_id||r.montant||r.date_avance)&&s.jsxs(Me,{variant:"destructive",children:[s.jsx(Re,{className:"h-4 w-4"}),s.jsx(Te,{children:r.professeur_id||r.montant||r.date_avance})]}),e[21]=r.date_avance,e[22]=r.montant,e[23]=r.professeur_id,e[24]=u):u=e[24];let ne;e[25]===Symbol.for("react.memo_cache_sentinel")?(ne=s.jsxs(os,{className:"grid w-full grid-cols-2",children:[s.jsx(ke,{value:"infos",children:"Informations"}),s.jsx(ke,{value:"details",children:"Détails"})]}),e[25]=ne):ne=e[25];let ie;e[26]===Symbol.for("react.memo_cache_sentinel")?(ie=s.jsx(be,{children:"Date de l'avance *"}),e[26]=ie):ie=e[26];let ce;e[27]===Symbol.for("react.memo_cache_sentinel")?(ce=s.jsx(ps,{className:"mr-2 h-4 w-4"}),e[27]=ce):ce=e[27];let x;e[28]!==c?(x=c?Ee(c,"dd MMMM yyyy",{locale:Le}):s.jsx("span",{children:"Sélectionner une date"}),e[28]=c,e[29]=x):x=e[29];let h;e[30]!==x?(h=s.jsx(rs,{asChild:!0,children:s.jsxs(K,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[ce,x]})}),e[30]=x,e[31]=h):h=e[31];let p;e[32]!==De||e[33]!==c?(p=s.jsx(ns,{className:"w-auto p-0",children:s.jsx(is,{mode:"single",selected:c,onSelect:De,locale:Le,className:"rounded-md border",disabled:_s})}),e[32]=De,e[33]=c,e[34]=p):p=e[34];let j;e[35]!==h||e[36]!==p?(j=s.jsxs(cs,{children:[h,p]}),e[35]=h,e[36]=p,e[37]=j):j=e[37];let v;e[38]!==a.date_avance?(v=s.jsx("input",{type:"hidden",name:"date_avance",value:a.date_avance}),e[38]=a.date_avance,e[39]=v):v=e[39];let _;e[40]!==c?(_=c&&s.jsx("div",{className:"mt-2",children:s.jsx("div",{className:"text-sm font-medium",children:Ee(c,"EEEE",{locale:Le})})}),e[40]=c,e[41]=_):_=e[41];let N;e[42]!==j||e[43]!==v||e[44]!==_?(N=s.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:s.jsxs("div",{className:"flex-1",children:[j,v,_]})}),e[42]=j,e[43]=v,e[44]=_,e[45]=N):N=e[45];let y;e[46]!==r.date_avance?(y=r.date_avance&&s.jsx("p",{className:"text-sm text-destructive",children:r.date_avance}),e[46]=r.date_avance,e[47]=y):y=e[47];let b;e[48]!==N||e[49]!==y?(b=s.jsxs("div",{className:"space-y-4",children:[ie,N,y]}),e[48]=N,e[49]=y,e[50]=b):b=e[50];let oe;e[51]===Symbol.for("react.memo_cache_sentinel")?(oe=s.jsx(be,{htmlFor:"professeur_id",children:"Professeur *"}),e[51]=oe):oe=e[51];const Ke=a.professeur_id;let g;e[52]!==i?(g=t=>i("professeur_id",t),e[52]=i,e[53]=g):g=e[53];let me;e[54]===Symbol.for("react.memo_cache_sentinel")?(me=s.jsx($e,{children:s.jsx(Ue,{placeholder:"Sélectionner un professeur"})}),e[54]=me):me=e[54];let S;if(e[55]!==m){let t;e[57]===Symbol.for("react.memo_cache_sentinel")?(t=n=>s.jsx(ge,{value:n.id.toString(),children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-6 w-6 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx("span",{className:"text-xs font-bold",children:n.nom.charAt(0).toUpperCase()})}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:n.nom}),s.jsx("div",{className:"text-xs text-muted-foreground",children:n.email}),n.prof_salaire&&s.jsxs("div",{className:"text-xs text-muted-foreground",children:["Salaire: ",d(n.prof_salaire.type_salaire==="horaire"?(n.prof_salaire.taux_horaire||0)*35*4.33:n.prof_salaire.salaire_fixe||0)]})]})]})},n.id),e[57]=t):t=e[57],S=m.map(t),e[55]=m,e[56]=S}else S=e[56];let C;e[58]!==S?(C=s.jsx(ze,{children:S}),e[58]=S,e[59]=C):C=e[59];let D;e[60]!==a.professeur_id||e[61]!==g||e[62]!==C?(D=s.jsxs(Ve,{value:Ke,onValueChange:g,children:[me,C]}),e[60]=a.professeur_id,e[61]=g,e[62]=C,e[63]=D):D=e[63];let de;e[64]===Symbol.for("react.memo_cache_sentinel")?(de=s.jsx("p",{className:"text-xs text-muted-foreground",children:"Sélectionnez le professeur demandeur"}),e[64]=de):de=e[64];let w;e[65]!==r.professeur_id?(w=r.professeur_id&&s.jsx("p",{className:"text-sm text-destructive",children:r.professeur_id}),e[65]=r.professeur_id,e[66]=w):w=e[66];let F;e[67]!==D||e[68]!==w?(F=s.jsxs("div",{className:"space-y-4",children:[oe,D,de,w]}),e[67]=D,e[68]=w,e[69]=F):F=e[69];let P;e[70]!==b||e[71]!==F?(P=s.jsxs(Be,{value:"infos",className:"space-y-6 pt-6",children:[b,F]}),e[70]=b,e[71]=F,e[72]=P):P=e[72];let A;e[73]!==l||e[74]!==o?(A=o?.prof_salaire&&s.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[s.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[s.jsx(us,{className:"h-4 w-4"}),"Information sur le salaire"]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-muted-foreground",children:"Type de salaire"}),s.jsx("p",{className:"font-medium",children:o.prof_salaire.type_salaire==="horaire"?"Horaire":"Mensuel"})]}),o.prof_salaire.type_salaire==="horaire"&&s.jsxs("div",{children:[s.jsx("p",{className:"text-muted-foreground",children:"Taux horaire"}),s.jsxs("p",{className:"font-medium",children:[d(o.prof_salaire.taux_horaire||0),"/h"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-muted-foreground",children:"Salaire mensuel estimé"}),s.jsx("p",{className:"font-medium",children:d(o.prof_salaire.type_salaire==="horaire"?(o.prof_salaire.taux_horaire||0)*35*4.33:o.prof_salaire.salaire_fixe||0)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-muted-foreground",children:"Avance maximum"}),s.jsxs("p",{className:"font-medium text-green-600",children:[d(l)," (50%)"]})]})]})]}),e[73]=l,e[74]=o,e[75]=A):A=e[75];let fe;e[76]===Symbol.for("react.memo_cache_sentinel")?(fe=s.jsx(be,{htmlFor:"montant",children:"Montant de l'avance *"}),e[76]=fe):fe=e[76];let M;e[77]!==we?(M=t=>we(t.target.value),e[77]=we,e[78]=M):M=e[78];let T;e[79]!==a.montant||e[80]!==l||e[81]!==M?(T=s.jsx(Ze,{id:"montant",type:"number",step:"0.01",min:"0",max:l,value:a.montant,onChange:M,placeholder:"0,00",className:"pl-10 text-lg"}),e[79]=a.montant,e[80]=l,e[81]=M,e[82]=T):T=e[82];let ue;e[83]===Symbol.for("react.memo_cache_sentinel")?(ue=s.jsx(js,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e[83]=ue):ue=e[83];let E;e[84]!==T?(E=s.jsxs("div",{className:"relative",children:[T,ue]}),e[84]=T,e[85]=E):E=e[85];let L;e[86]!==Fe||e[87]!==l?(L=l>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Sélection rapide"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[10,25,50,75].map(t=>s.jsxs(K,{type:"button",variant:"outline",size:"sm",onClick:()=>Fe(t),className:"flex items-center gap-1",children:[s.jsx(vs,{className:"h-3 w-3"}),t,"%"]},t))})]}),e[86]=Fe,e[87]=l,e[88]=L):L=e[88];let R;e[89]!==a.montant||e[90]!==l?(R=a.montant&&l>0&&s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Pourcentage du maximum:"}),s.jsxs("span",{className:`font-medium ${parseFloat(a.montant)>l?"text-red-600":"text-green-600"}`,children:[(parseFloat(a.montant)/l*100).toFixed(1),"%"]})]}),parseFloat(a.montant)>l?s.jsxs(Me,{variant:"destructive",children:[s.jsx(Re,{className:"h-4 w-4"}),s.jsxs(Te,{children:["Le montant dépasse la limite autorisée de ",d(l)]})]}):s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Reste disponible: ",d(l-parseFloat(a.montant))]})]}),e[89]=a.montant,e[90]=l,e[91]=R):R=e[91];let I;e[92]!==l?(I=d(l),e[92]=l,e[93]=I):I=e[93];let H;e[94]!==I?(H=s.jsxs("p",{className:"text-xs text-muted-foreground",children:["Maximum: ",I," (50% du salaire mensuel)"]}),e[94]=I,e[95]=H):H=e[95];let V;e[96]!==r.montant?(V=r.montant&&s.jsx("p",{className:"text-sm text-destructive",children:r.montant}),e[96]=r.montant,e[97]=V):V=e[97];let $;e[98]!==E||e[99]!==L||e[100]!==R||e[101]!==H||e[102]!==V?($=s.jsxs("div",{className:"space-y-4",children:[fe,E,L,R,H,V]}),e[98]=E,e[99]=L,e[100]=R,e[101]=H,e[102]=V,e[103]=$):$=e[103];let xe;e[104]===Symbol.for("react.memo_cache_sentinel")?(xe=s.jsx(be,{htmlFor:"statut",children:"Statut"}),e[104]=xe):xe=e[104];let U;e[105]!==i?(U=t=>i("statut",t),e[105]=i,e[106]=U):U=e[106];let he;e[107]===Symbol.for("react.memo_cache_sentinel")?(he=s.jsx($e,{children:s.jsx(Ue,{placeholder:"Sélectionner un statut"})}),e[107]=he):he=e[107];let pe;e[108]===Symbol.for("react.memo_cache_sentinel")?(pe=s.jsxs(ze,{children:[s.jsx(ge,{value:"demandee",children:"Demandée"}),s.jsx(ge,{value:"approuvee",children:"Approuvée"}),s.jsx(ge,{value:"payee",children:"Payée"})]}),e[108]=pe):pe=e[108];let z;e[109]!==a.statut||e[110]!==U?(z=s.jsxs(Ve,{value:a.statut,onValueChange:U,children:[he,pe]}),e[109]=a.statut,e[110]=U,e[111]=z):z=e[111];let je;e[112]===Symbol.for("react.memo_cache_sentinel")?(je=s.jsx("p",{className:"text-xs text-muted-foreground",children:`Par défaut, l'avance est créée avec le statut "Demandée"`}),e[112]=je):je=e[112];let k;e[113]!==z?(k=s.jsxs("div",{className:"space-y-4",children:[xe,z,je]}),e[113]=z,e[114]=k):k=e[114];let ve;e[115]===Symbol.for("react.memo_cache_sentinel")?(ve=s.jsxs(Me,{children:[s.jsx(Re,{className:"h-4 w-4"}),s.jsx(Te,{children:"L'avance sera automatiquement déduite du prochain salaire du professeur. Une dépense sera créée dans le système lors du paiement."})]}),e[115]=ve):ve=e[115];let B;e[116]!==A||e[117]!==$||e[118]!==k?(B=s.jsxs(Be,{value:"details",className:"space-y-6 pt-6",children:[A,$,k,ve]}),e[116]=A,e[117]=$,e[118]=k,e[119]=B):B=e[119];let q;e[120]!==P||e[121]!==B?(q=s.jsxs(ms,{defaultValue:"infos",className:"w-full",children:[ne,P,B]}),e[120]=P,e[121]=B,e[122]=q):q=e[122];let _e;e[123]===Symbol.for("react.memo_cache_sentinel")?(_e=s.jsx(He,{href:"/avance-salaires",children:s.jsx(K,{type:"button",variant:"outline",children:"Annuler"})}),e[123]=_e):_e=e[123];const Pe=Ie||a.montant&&parseFloat(a.montant)>l,Ae=Ie?"Enregistrement en cours...":"Enregistrer la demande";let G;e[124]!==Pe||e[125]!==Ae?(G=s.jsxs("div",{className:"flex items-center justify-end gap-4 pt-6 border-t",children:[_e,s.jsx(K,{type:"submit",disabled:Pe,children:Ae})]}),e[124]=Pe,e[125]=Ae,e[126]=G):G=e[126];let Ne;return e[127]!==Ce||e[128]!==u||e[129]!==q||e[130]!==G?(Ne=s.jsxs(s.Fragment,{children:[te,s.jsxs(ds,{activeRoute:"/avance-salaires",children:[le,s.jsxs(as,{className:"max-w-3xl mx-auto",children:[re,s.jsx(ls,{children:s.jsxs("form",{onSubmit:Ce,className:"space-y-6",children:[u,q,G]})})]})]})]}),e[127]=Ce,e[128]=u,e[129]=q,e[130]=G,e[131]=Ne):Ne=e[131],Ne}function _s(J){return J>new Date}function Ns(J){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(J).replace("$US","$")}export{Gs as default};
