import{r as m,b as j,j as e,H as Z,L as A}from"./app-DGSNNkrG.js";import{c as ee,B as x}from"./createLucideIcon-Uuj4pdsM.js";import{I as _}from"./input-XYJxKMah.js";import{L as w}from"./label-CW5PwnjD.js";import{e as se,c as ae,T as S,b as n,d as re,a as i}from"./table-CuF74Ye4.js";import{b as o,c as h,C as q,a as B,d as $}from"./card-B5T1-of4.js";import{B as p}from"./badge-I5fyqHqU.js";import{A as H,a as I}from"./alert-CXKem-lg.js";import{D as te,S as le,F as U,h as ie}from"./DashboardLayout-DOd2BJeH.js";import{S as C,a as T,b as D,c as P,d as r}from"./select-BpwhUyeJ.js";import{P as ce}from"./PageHeader-zCSS31-G.js";import{P as de}from"./pagination-DjH04XKA.js";import{P as ne}from"./printer-ww0w3dU5.js";import{W as z}from"./wallet-4rOmeRye.js";import{T as F}from"./trending-up-BdprcOaD.js";import{T as k}from"./trending-down-BQYzi5u3.js";import{F as xe}from"./funnel-BkPtUdOj.js";import{C as oe}from"./users-Bc8nYIP1.js";import{U as V}from"./user-Cg7A2IXi.js";/* empty css            */import"./index-DlNuphDD.js";import"./index-Dp6su7tU.js";import"./check-DG9Xblsj.js";import"./house-CU0a6S1I.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],me=ee("refresh-cw",he);function Ie({auth:je,mouvements:c,stats:a,filters:l,periodes:L,flash:u}){const[g,M]=m.useState(l.search||""),[f,N]=m.useState(l.date_debut||""),[b,v]=m.useState(l.date_fin||""),[pe,ue]=m.useState("aujourdhui"),[J,R]=m.useState(!1);m.useEffect(()=>{const s=setTimeout(()=>{j.get("/caisse",{search:g},{preserveState:!0,replace:!0})},500);return()=>clearTimeout(s)},[g]);const W=s=>{const t=L.find(Y=>Y.label===s);t&&(N(t.date_debut),v(t.date_fin),j.get("/caisse",{...l,date_debut:t.date_debut,date_fin:t.date_fin},{preserveState:!0,replace:!0}))},y=(s,t)=>{j.get("/caisse",{...l,[s]:t},{preserveState:!0,replace:!0})},G=()=>{j.get("/caisse",{...l,date_debut:f,date_fin:b},{preserveState:!0,replace:!0})},E=()=>{j.get("/caisse",{per_page:l.per_page||15},{preserveState:!0,replace:!0}),M(""),N(""),v("")},d=s=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"USD"}).format(s).replace("$US","$"),K=s=>new Date(s).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),O=s=>s==="entree"?e.jsxs(p,{className:"bg-green-500 hover:bg-green-600",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Entrée"]}):e.jsxs(p,{variant:"destructive",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),"Sortie"]}),Q=s=>{const t={espèce:"bg-blue-100 text-blue-800 hover:bg-blue-100",chèque:"bg-purple-100 text-purple-800 hover:bg-purple-100",virement:"bg-green-100 text-green-800 hover:bg-green-100",carte:"bg-orange-100 text-orange-800 hover:bg-orange-100",mobile_money:"bg-pink-100 text-pink-800 hover:bg-pink-100"};return e.jsx(p,{variant:"outline",className:t[s]||"",children:s})},X=async s=>{R(!0);try{const t=new URLSearchParams({...l,search:g,format:s});window.open(`/caisse/export?${t.toString()}`,"_blank")}catch(t){console.error("Erreur export:",t)}finally{R(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Journal de caisse"}),e.jsxs(te,{activeRoute:"/caisse",children:[e.jsx(ce,{title:"Journal de caisse",description:"Suivi des entrées et sorties de fonds",breadcrumb:[{label:"Dashboard",href:"/dashboard"},{label:"Caisse",href:"/caisse"}],actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{variant:"outline",onClick:()=>X("pdf"),disabled:J,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"PDF"]}),e.jsxs(x,{onClick:E,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Actualiser"]})]})}),u?.success&&e.jsx(H,{className:"mb-6",children:e.jsx(I,{children:u.success})}),u?.error&&e.jsx(H,{variant:"destructive",className:"mb-6",children:e.jsx(I,{children:u.error})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(o,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Solde initial"}),e.jsx("p",{className:`text-2xl font-bold ${a.solde_debut>=0?"text-green-600":"text-destructive"}`,children:d(a.solde_debut)})]}),e.jsx(z,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(o,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total entrées"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d(a.total_entrees)})]}),e.jsx(F,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(o,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total sorties"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:d(a.total_sorties)})]}),e.jsx(k,{className:"h-8 w-8 text-destructive"})]})})}),e.jsx(o,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Solde final"}),e.jsx("p",{className:`text-2xl font-bold ${a.solde_fin>=0?"text-green-600":"text-destructive"}`,children:d(a.solde_fin)})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.nombre_operations," opérations"]})})]})})})]}),e.jsx(o,{className:"mb-6",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_,{placeholder:"Rechercher par référence, libellé, bénéficiaire...",value:g,onChange:s=>M(s.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{value:l.type||"all",onValueChange:s=>y("type",s),children:[e.jsxs(T,{className:"w-[120px]",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),e.jsx(D,{placeholder:"Type"})]}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"Tous types"}),e.jsx(r,{value:"entree",children:"Entrées"}),e.jsx(r,{value:"sortie",children:"Sorties"})]})]}),e.jsxs(C,{value:l.mode_paiement||"all",onValueChange:s=>y("mode_paiement",s),children:[e.jsx(T,{className:"w-[140px]",children:e.jsx(D,{placeholder:"Paiement"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"Tous modes"}),e.jsx(r,{value:"espèce",children:"Espèce"}),e.jsx(r,{value:"chèque",children:"Chèque"}),e.jsx(r,{value:"virement",children:"Virement"}),e.jsx(r,{value:"carte",children:"Carte"}),e.jsx(r,{value:"mobile_money",children:"Mobile Money"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(w,{className:"mb-2 block",children:"Périodes rapides"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:L.map(s=>e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>W(s.label),className:f===s.date_debut&&b===s.date_fin?"bg-primary text-primary-foreground":"",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),s.label]},s.label))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"date_debut",children:"Date début"}),e.jsx(_,{id:"date_debut",type:"date",value:f,onChange:s=>N(s.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"date_fin",children:"Date fin"}),e.jsx(_,{id:"date_fin",type:"date",value:b,onChange:s=>v(s.target.value),className:"mt-1"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(x,{onClick:G,className:"w-full",children:"Appliquer dates"})})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(C,{value:l.per_page?.toString()||"15",onValueChange:s=>y("per_page",s),children:[e.jsx(T,{className:"w-[100px]",children:e.jsx(D,{placeholder:"Par page"})}),e.jsxs(P,{children:[e.jsx(r,{value:"10",children:"10"}),e.jsx(r,{value:"15",children:"15"}),e.jsx(r,{value:"25",children:"25"}),e.jsx(r,{value:"50",children:"50"}),e.jsx(r,{value:"100",children:"100"})]})]})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage ",c.from," à ",c.to," sur ",c.total," mouvements"]})]}),e.jsx("div",{children:e.jsx(x,{variant:"ghost",size:"sm",onClick:E,children:"Réinitialiser filtres"})})]})]})})}),e.jsxs(o,{children:[e.jsxs(q,{children:[e.jsx(B,{children:"Journal des opérations"}),e.jsx($,{children:"Liste chronologique des mouvements de caisse"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(S,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Référence"}),e.jsx(n,{children:"Libellé"}),e.jsx(n,{children:"Détails"}),e.jsx(n,{children:"Mode paiement"}),e.jsx(n,{className:"text-right",children:"Montant"}),e.jsx(n,{className:"text-right",children:"Actions"})]})}),e.jsx(re,{children:c.data.length===0?e.jsx(S,{children:e.jsxs(i,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:[e.jsx(z,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{className:"text-lg",children:"Aucun mouvement trouvé"}),e.jsx("p",{className:"text-sm",children:"Modifiez vos critères de recherche"})]})}):c.data.map(s=>e.jsxs(S,{className:"hover:bg-muted/50",children:[e.jsxs(i,{children:[e.jsx("div",{className:"font-medium",children:K(s.date)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx(i,{children:O(s.type)}),e.jsx(i,{children:e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.reference})}),e.jsxs(i,{children:[e.jsx("div",{className:"font-medium",children:s.libelle}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Par ",s.user.name]})]}),e.jsxs(i,{children:[s.type==="entree"&&s.eleve&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:s.eleve.nom_complet})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Mat: ",s.eleve.matricule]}),s.details?.tranche&&e.jsx(p,{variant:"outline",className:"text-xs",children:s.details.tranche})]}),s.type==="sortie"&&e.jsxs("div",{className:"space-y-1",children:[s.details?.beneficiaire&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:s.details.beneficiaire})]}),s.details?.categorie&&e.jsx(p,{variant:"outline",className:"text-xs",children:s.details.categorie}),s.budget&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Budget: ",s.budget.nom_complet]})]})]}),e.jsx(i,{children:Q(s.mode_paiement)}),e.jsxs(i,{className:"text-right",children:[e.jsxs("div",{className:`font-bold ${s.type==="entree"?"text-green-600":"text-destructive"}`,children:[s.type==="entree"?"+":"-"," ",d(s.montant)]}),s.statut&&e.jsx(p,{variant:"secondary",className:"text-xs mt-1",children:s.statut})]}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[s.type==="entree"&&e.jsx(A,{href:`/paiements/${s.id}`,children:e.jsx(x,{variant:"ghost",size:"sm",children:e.jsx(U,{className:"h-4 w-4"})})}),s.type==="sortie"&&e.jsx(A,{href:`/depenses/${s.id}`,children:e.jsx(x,{variant:"ghost",size:"sm",children:e.jsx(U,{className:"h-4 w-4"})})})]})})]},s.id))})]})}),c.last_page>1&&e.jsx("div",{className:"border-t pt-4 mt-4",children:e.jsx(de,{currentPage:c.current_page,totalPages:c.last_page,onPageChange:s=>{j.get("/caisse",{...l,page:s},{preserveState:!0,replace:!0})}})})]})]}),a.jour_max_entrees&&e.jsxs(o,{className:"mt-6",children:[e.jsxs(q,{children:[e.jsx(B,{children:"Analyse"}),e.jsx($,{children:"Statistiques détaillées des mouvements"})]}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Journée record"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 border rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Plus d'entrées"}),e.jsx("p",{className:"font-medium",children:a.jour_max_entrees})]}),e.jsx(F,{className:"h-5 w-5 text-green-500"})]})}),e.jsx("div",{className:"p-3 border rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Plus de sorties"}),e.jsx("p",{className:"font-medium",children:a.jour_max_sorties})]}),e.jsx(k,{className:"h-5 w-5 text-destructive"})]})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Répartition"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Entrées"}),e.jsx("span",{className:"font-medium text-green-600",children:d(a.total_entrees)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Sorties"}),e.jsx("span",{className:"font-medium text-destructive",children:d(a.total_sorties)})]}),e.jsx(ie,{}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Solde net"}),e.jsx("span",{className:a.solde_fin>=0?"text-green-600":"text-destructive",children:d(a.solde_fin)})]})]})]})]})})]})]})]})}export{Ie as default};
