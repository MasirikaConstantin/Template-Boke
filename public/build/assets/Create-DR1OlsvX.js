import{u as z,r as m,j as e,H as k,L as P,b as B}from"./app-uqHmN79t.js";import{B as u}from"./createLucideIcon-DdtqxNsI.js";import{I as p}from"./input-DvfwZFkz.js";import{L as l}from"./label-PQ5rEKFu.js";import{S as j,a as f,b as v,c as N,d as o}from"./select-BDqdA6RC.js";import{b as G,C as J,a as K,d as O,c as Q}from"./card-D_YRJqod.js";import{A as D,a as F}from"./alert-Bcv8EiY-.js";import{c as W,P as X,f as x,b as Y,C as Z,a as g}from"./popover-Cm50hUcY.js";import{c as ee,T as se,a as y,b as _}from"./tabs-a-Tu6bgY.js";import{D as ae,g as A}from"./DashboardLayout-BR-aq2td.js";import{P as te}from"./PageHeader-Du2510Il.js";import{A as re}from"./arrow-left-BoKgi2Hq.js";import{a as le,C as T}from"./users-CWldF8sk.js";import{C as E}from"./circle-alert-CUEVtP0P.js";import{C as ne}from"./calculator-BFrCOpTX.js";import{T as ie}from"./trending-up-BYRikWhP.js";import{C as de}from"./clock-BKdoMcGC.js";import{P as ce}from"./percent-OMY3LEGH.js";/* empty css            */import"./index-CapVt91Y.js";import"./index-BII6AP8K.js";import"./check-oMVJ0WoU.js";import"./user-CQKIz47G.js";import"./house-CPHwcq2r.js";function Re({professeurs:h,today:b,periode_courante:M}){const{data:a,setData:t,post:L,processing:C,errors:r,reset:oe}=z({professeur_id:"",type_paiement:"normal",montant:"",date_paiement:b,periode:M,statut:"paye",avance_id:"",heures_travaillees:"",retenues:""}),[i,R]=m.useState(new Date(b)),[d,q]=m.useState(null),[c,H]=m.useState(null),[S,w]=m.useState(!1);m.useEffect(()=>{if(a.professeur_id){const s=h.find($=>$.id.toString()===a.professeur_id);q(s||null)}},[a.professeur_id,h]);const V=s=>{s.preventDefault(),L("/paiement-salaires")},I=s=>{s&&(R(s),t("date_paiement",x(s,"yyyy-MM-dd")))},U=async()=>{if(!a.professeur_id||!a.periode){alert("Veuillez sélectionner un professeur et une période");return}w(!0);try{const s=await B.post("/paiement-salaires/calculer",{professeur_id:a.professeur_id,periode:a.periode});s.data&&(H(s.data),t("montant",s.data.net_a_payer.toString()),t("heures_travaillees",s.data.heures_travaillees.toString()))}catch(s){console.error("Erreur lors du calcul:",s),alert("Erreur lors du calcul automatique")}finally{w(!1)}},n=s=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s).replace("$US","$");return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Créer un paiement de salaire"}),e.jsxs(ae,{activeRoute:"/depenses",children:[e.jsx(te,{title:"Nouveau paiement",breadcrumb:[{label:"Dashboard",href:"/dashboard"},{label:"Finances",href:"#"},{label:"Paiements",href:"/paiement-salaires"},{label:"Créer",href:"/paiement-salaires/create"}],actions:e.jsx(P,{href:"/paiement-salaires",children:e.jsxs(u,{variant:"outline",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Retour"]})})}),e.jsxs(G,{className:"max-w-4xl mx-auto",children:[e.jsxs(J,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Nouveau paiement de salaire"]}),e.jsx(O,{children:"Enregistrez un paiement de salaire pour un professeur"})]}),e.jsx(Q,{children:e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[(r.professeur_id||r.montant)&&e.jsxs(D,{variant:"destructive",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(F,{children:r.professeur_id||r.montant})]}),e.jsxs(ee,{defaultValue:"infos",className:"w-full",children:[e.jsxs(se,{className:"grid w-full grid-cols-3",children:[e.jsx(y,{value:"infos",children:"Informations"}),e.jsx(y,{value:"calcul",children:"Calcul"}),e.jsx(y,{value:"details",children:"Détails"})]}),e.jsxs(_,{value:"infos",className:"space-y-6 pt-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{children:"Date de paiement *"}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(u,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),i?x(i,"dd MMMM yyyy",{locale:g}):e.jsx("span",{children:"Sélectionner une date"})]})}),e.jsx(Y,{className:"w-auto p-0",children:e.jsx(Z,{mode:"single",selected:i,onSelect:I,locale:g,className:"rounded-md border",disabled:s=>s>new Date})})]}),e.jsx("input",{type:"hidden",name:"date_paiement",value:a.date_paiement}),i&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"text-sm font-medium",children:x(i,"EEEE",{locale:g})})})]})}),r.date_paiement&&e.jsx("p",{className:"text-sm text-destructive",children:r.date_paiement})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{htmlFor:"professeur_id",children:"Professeur *"}),e.jsxs(j,{value:a.professeur_id,onValueChange:s=>t("professeur_id",s),children:[e.jsx(f,{children:e.jsx(v,{placeholder:"Sélectionner un professeur"})}),e.jsx(N,{children:h.map(s=>e.jsx(o,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-6 w-6 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold",children:s.nom.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.nom}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.email}),s.prof_salaire&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.prof_salaire.type_salaire==="horaire"?`${n(s.prof_salaire.taux_horaire||0)}/h`:`${n(s.prof_salaire.salaire_fixe||0)}/mois`})]})]})},s.id))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sélectionnez le professeur concerné"}),r.professeur_id&&e.jsx("p",{className:"text-sm text-destructive",children:r.professeur_id})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{htmlFor:"type_paiement",children:"Type de paiement *"}),e.jsxs(j,{value:a.type_paiement,onValueChange:s=>{t("type_paiement",s),s!=="normal"&&t("periode","")},children:[e.jsx(f,{children:e.jsx(v,{placeholder:"Sélectionner un type"})}),e.jsxs(N,{children:[e.jsx(o,{value:"normal",children:"Salaire normal"}),e.jsx(o,{value:"avance",children:"Avance"}),e.jsx(o,{value:"regularisation",children:"Régularisation"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.type_paiement==="normal"&&"Paiement mensuel régulier",a.type_paiement==="avance"&&"Avance sur salaire",a.type_paiement==="regularisation"&&"Paiement de régularisation"]})]}),a.type_paiement==="normal"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{htmlFor:"periode",children:"Période *"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"periode",type:"month",value:a.periode,onChange:s=>t("periode",s.target.value),className:"pl-10"}),e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"})]}),a.periode&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Période sélectionnée: ",new Date(a.periode+"-01").toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]}),r.periode&&e.jsx("p",{className:"text-sm text-destructive",children:r.periode})]})]}),e.jsxs(_,{value:"calcul",className:"space-y-6 pt-6",children:[a.type_paiement==="normal"&&a.professeur_id&&a.periode&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Calcul automatique"}),e.jsxs(u,{type:"button",variant:"outline",onClick:U,disabled:S,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),S?"Calcul en cours...":"Calculer automatiquement"]})]}),c&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Résultat du calcul"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Salaire de base"}),e.jsx("p",{className:"font-medium",children:n(c.salaire_base)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Avances à déduire"}),e.jsxs("p",{className:"font-medium text-red-600",children:["-",n(c.avances_deduites)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Heures travaillées"}),e.jsxs("p",{className:"font-medium",children:[c.heures_travaillees,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Net à payer"}),e.jsx("p",{className:"font-medium text-green-600 text-lg",children:n(c.net_a_payer)})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Période: ",c.periode_label]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{htmlFor:"heures_travaillees",children:"Heures travaillées"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"heures_travaillees",type:"number",step:"0.01",min:"0",value:a.heures_travaillees,onChange:s=>t("heures_travaillees",s.target.value),placeholder:"0,00",className:"pl-10"}),e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Laisser vide pour utiliser le calcul automatique"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{htmlFor:"retenues",children:"Retenues diverses"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"retenues",type:"number",step:"0.01",min:"0",value:a.retenues,onChange:s=>t("retenues",s.target.value),placeholder:"0,00",className:"pl-10"}),e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Montant des retenues diverses (cotisations, etc.)"})]})]}),(a.type_paiement==="avance"||a.type_paiement==="regularisation")&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{htmlFor:"montant",children:"Montant *"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"montant",type:"number",step:"0.01",min:"0",value:a.montant,onChange:s=>t("montant",s.target.value),placeholder:"0,00",className:"pl-10 text-lg"}),e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Montant du ",a.type_paiement==="avance"?"de l'avance":"de la régularisation"]}),r.montant&&e.jsx("p",{className:"text-sm text-destructive",children:r.montant})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{htmlFor:"montant_final",children:"Montant final à payer *"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"montant_final",type:"number",step:"0.01",min:"0",value:a.montant,onChange:s=>t("montant",s.target.value),placeholder:"0,00",className:"pl-10 text-lg",disabled:a.type_paiement==="normal"&&!!c}),e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"})]}),a.montant&&e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["Net à payer: ",n(parseFloat(a.montant)||0)]})]})]}),e.jsxs(_,{value:"details",className:"space-y-6 pt-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{htmlFor:"statut",children:"Statut"}),e.jsxs(j,{value:a.statut,onValueChange:s=>t("statut",s),children:[e.jsx(f,{children:e.jsx(v,{placeholder:"Sélectionner un statut"})}),e.jsxs(N,{children:[e.jsx(o,{value:"paye",children:"Payé"}),e.jsx(o,{value:"en_attente",children:"En attente"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Le statut "Payé" créera automatiquement une dépense dans le système'})]}),d?.prof_salaire&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Configuration de salaire"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Type de salaire"}),e.jsx("p",{className:"font-medium",children:d.prof_salaire.type_salaire==="horaire"?"Horaire":"Mensuel"})]}),d.prof_salaire.type_salaire==="horaire"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Taux horaire"}),e.jsxs("p",{className:"font-medium",children:[n(d.prof_salaire.taux_horaire||0),"/h"]})]}),d.prof_salaire.type_salaire==="mensuel"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Salaire fixe"}),e.jsxs("p",{className:"font-medium",children:[n(d.prof_salaire.salaire_fixe||0),"/mois"]})]})]})]}),e.jsxs(D,{children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(F,{children:a.statut==="paye"?"Une dépense sera automatiquement créée dans le système lors de l'enregistrement.":"Le paiement sera enregistré comme en attente. Vous pourrez le marquer comme payé plus tard."})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Récapitulatif"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Professeur:"}),e.jsx("span",{className:"font-medium",children:d?.nom||"Non sélectionné"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type de paiement:"}),e.jsxs("span",{className:"font-medium",children:[a.type_paiement==="normal"&&"Salaire normal",a.type_paiement==="avance"&&"Avance",a.type_paiement==="regularisation"&&"Régularisation"]})]}),a.type_paiement==="normal"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Période:"}),e.jsx("span",{className:"font-medium",children:a.periode?new Date(a.periode+"-01").toLocaleDateString("fr-FR",{month:"long",year:"numeric"}):"Non spécifiée"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date de paiement:"}),e.jsx("span",{className:"font-medium",children:i?x(i,"dd/MM/yyyy"):"Non spécifiée"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Montant:"}),e.jsx("span",{className:"font-medium text-lg",children:a.montant?n(parseFloat(a.montant)):"0,00 €"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Statut:"}),e.jsx("span",{className:"font-medium",children:a.statut==="paye"?"Payé":"En attente"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-6 border-t",children:[e.jsx(P,{href:"/paiement-salaires",children:e.jsx(u,{type:"button",variant:"outline",children:"Annuler"})}),e.jsx(u,{type:"submit",disabled:C,children:C?"Enregistrement en cours...":"Enregistrer le paiement"})]})]})})]})]})]})}export{Re as default};
